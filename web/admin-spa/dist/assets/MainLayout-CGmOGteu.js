import{x as r,y as o,z as e,Q as $,L as U,A as z,C as S,P as y,c as C,r as _,_ as B,q as R,V as F,R as w,J as j,Y as L,O as h,T as J,K as P,aq as T,aU as E,ac as D,o as H,av as Q,aW as W,D as Y}from"./vue-vendor-Bsazo-x0.js";import{_ as I,u as N,c as V,s as k}from"./index-BtHs_jz9.js";import{T as G}from"./ThemeToggle-D5c3jI2n.js";import"./element-plus-C5sO7D8l.js";import"./vendor-C8JtMHuO.js";const X={class:"flex items-center gap-4"},Z={class:"flex h-12 w-12 flex-shrink-0 items-center justify-center overflow-hidden rounded-xl border border-gray-300/30 bg-gradient-to-br from-blue-500/20 to-purple-500/20 backdrop-blur-sm dark:border-gray-600/30 dark:from-blue-600/20 dark:to-purple-600/20"},ee=["src"],te={key:1,class:"fas fa-cloud text-xl text-gray-700 dark:text-gray-300"},se={key:1,class:"h-8 w-8 animate-pulse rounded bg-gray-300/50 dark:bg-gray-600/50"},ae={class:"flex min-h-[48px] flex-col justify-center"},re={class:"flex items-center gap-3"},oe={key:1,class:"h-8 w-64 animate-pulse rounded bg-gray-300/50 dark:bg-gray-600/50"},ne={key:0,class:"mt-0.5 text-sm leading-tight text-gray-600 dark:text-gray-400"},le={__name:"LogoTitle",props:{loading:{type:Boolean,default:!1},title:{type:String,default:""},subtitle:{type:String,default:""},logoSrc:{type:String,default:""},titleClass:{type:String,default:"text-gray-900"}},setup(d){const m=c=>{c.target.style.display="none"};return(c,g)=>(o(),r("div",X,[e("div",Z,[d.loading?(o(),r("div",se)):(o(),r($,{key:0},[d.logoSrc?(o(),r("img",{key:0,alt:"Logo",class:"h-8 w-8 object-contain",src:d.logoSrc,onError:m},null,40,ee)):(o(),r("i",te))],64))]),e("div",ae,[e("div",re,[!d.loading&&d.title?(o(),r("h1",{key:0,class:S(["header-title text-2xl font-bold leading-tight",d.titleClass])},y(d.title),3)):d.loading?(o(),r("div",oe)):U("",!0),z(c.$slots,"after-title",{},void 0,!0)]),d.subtitle?(o(),r("p",ne,y(d.subtitle),1)):U("",!0)])]))}},ie=I(le,[["__scopeId","data-v-15eb26fd"]]),de={class:"glass-strong mb-4 rounded-xl p-3 shadow-xl sm:mb-6 sm:rounded-2xl sm:p-4 md:mb-8 md:rounded-3xl md:p-6",style:{"z-index":"10",position:"relative"}},ue={class:"flex flex-col items-center justify-between gap-3 sm:flex-row sm:gap-4"},ce={class:"flex w-full items-center justify-center gap-2 sm:w-auto sm:justify-start sm:gap-3 md:gap-4"},me={class:"flex items-center gap-1 sm:gap-2"},ge={class:"font-mono text-xs text-gray-400 dark:text-gray-500 sm:text-sm"},fe=["href"],pe={class:"flex items-center gap-2 sm:gap-4"},xe={class:"flex items-center"},ye={class:"user-menu-container relative"},be={class:"hidden sm:inline"},ve={class:"border-b border-gray-100 px-4 py-3 dark:border-gray-700"},he={class:"flex items-center justify-between text-sm"},ke={class:"font-mono text-gray-700 dark:text-gray-300"},we={key:0,class:"mt-2"},_e={class:"mb-2 flex items-center justify-between text-sm"},Ue={class:"font-mono text-green-600 dark:text-green-400"},Ce=["href"],Pe={key:1,class:"mt-2 text-center text-xs text-gray-500 dark:text-gray-400"},Te={key:2,class:"mt-2 text-center"},$e={key:"message",class:"inline-block rounded-lg border border-green-200 bg-green-100 px-3 py-1.5 dark:border-green-800 dark:bg-green-900/30"},Se={key:0,class:"modal fixed inset-0 z-50 flex items-center justify-center p-3 sm:p-4"},Ie={class:"modal-content mx-auto flex max-h-[90vh] w-full max-w-md flex-col p-4 sm:p-6 md:p-8"},Me=["value"],Ne={class:"flex gap-3 pt-4"},Ae=["disabled"],je={key:0,class:"loading-spinner mr-2"},Le={key:1,class:"fas fa-save mr-2"},De={__name:"AppHeader",setup(d){const m=E(),c=N(),g=C(()=>c.user||{username:"Admin"}),i=C(()=>c.oemSettings||{}),n=C(()=>c.oemLoading),a=_({current:"...",latest:"",hasUpdate:!1,checkingUpdate:!1,lastChecked:null,releaseInfo:null,noUpdateMessage:!1}),x=_(!1),u=_(!1),l=_(!1),s=B({currentPassword:"",newPassword:"",confirmPassword:"",newUsername:""}),b=async()=>{if(!a.value.checkingUpdate){a.value.checkingUpdate=!0;try{const p=await V.get("/admin/check-updates");if(p.success){const t=p.data;a.value.current=t.current,a.value.latest=t.latest,a.value.hasUpdate=t.hasUpdate,a.value.releaseInfo=t.releaseInfo,a.value.lastChecked=new Date,localStorage.setItem("versionInfo",JSON.stringify({current:t.current,latest:t.latest,lastChecked:a.value.lastChecked,hasUpdate:t.hasUpdate,releaseInfo:t.releaseInfo})),t.hasUpdate||(a.value.noUpdateMessage=!0,setTimeout(()=>{a.value.noUpdateMessage=!1},3e3))}}catch(p){console.error("Error checking for updates:",p);const t=localStorage.getItem("versionInfo");if(t){const v=JSON.parse(t);a.value.current=v.current||a.value.current,a.value.latest=v.latest,a.value.hasUpdate=v.hasUpdate,a.value.releaseInfo=v.releaseInfo,a.value.lastChecked=new Date(v.lastChecked)}}finally{a.value.checkingUpdate=!1}}},K=()=>{s.currentPassword="",s.newPassword="",s.confirmPassword="",s.newUsername="",u.value=!0,x.value=!1},M=()=>{u.value=!1},O=async()=>{if(s.newPassword!==s.confirmPassword){k("两次输入的密码不一致","error");return}if(s.newPassword.length<8){k("新密码长度至少8位","error");return}l.value=!0;try{const p=await V.post("/web/auth/change-password",{currentPassword:s.currentPassword,newPassword:s.newPassword,newUsername:s.newUsername||void 0});if(p.success){const t=s.newUsername?"账户信息修改成功，请重新登录":"密码修改成功，请重新登录";k(t,"success"),M(),setTimeout(()=>{c.logout(),m.push("/login")},1500)}else k(p.message||"修改失败","error")}catch{k("修改密码失败","error")}finally{l.value=!1}},q=()=>{confirm("确定要退出登录吗？")&&(c.logout(),m.push("/login"),k("已安全退出","success")),x.value=!1},A=p=>{!p.target.closest(".user-menu-container")&&x.value&&(x.value=!1)};return R(()=>{b(),setInterval(()=>{b()},36e5),document.addEventListener("click",A)}),F(()=>{document.removeEventListener("click",A)}),(p,t)=>{var v;return o(),r($,null,[e("div",de,[e("div",ue,[e("div",ce,[w(ie,{loading:n.value,"logo-src":i.value.siteIconData||i.value.siteIcon,subtitle:"管理后台",title:i.value.siteName,"title-class":"text-white dark:text-gray-100"},{"after-title":j(()=>{var f;return[e("div",me,[e("span",ge,"v"+y(a.value.current||"..."),1),a.value.hasUpdate?(o(),r("a",{key:0,class:"inline-flex animate-pulse items-center gap-1 rounded-full border border-green-600 bg-green-500 px-2 py-0.5 text-xs text-white transition-colors hover:bg-green-600",href:((f=a.value.releaseInfo)==null?void 0:f.htmlUrl)||"#",target:"_blank",title:"有新版本可用"},t[7]||(t[7]=[e("i",{class:"fas fa-arrow-up text-[10px]"},null,-1),e("span",null,"新版本",-1)]),8,fe)):U("",!0)])]}),_:1},8,["loading","logo-src","title"])]),e("div",pe,[e("div",xe,[w(G,{mode:"dropdown"})]),t[18]||(t[18]=e("div",{class:"h-8 w-px bg-gradient-to-b from-transparent via-gray-300 to-transparent opacity-50 dark:via-gray-600"},null,-1)),e("div",ye,[e("button",{class:"user-menu-button flex items-center gap-2 rounded-2xl bg-gradient-to-r from-blue-500 to-blue-600 px-3 py-2 text-sm font-semibold text-white shadow-lg transition-all duration-200 hover:scale-105 hover:shadow-xl active:scale-95 sm:px-4 sm:py-2.5",onClick:t[0]||(t[0]=f=>x.value=!x.value)},[t[8]||(t[8]=e("i",{class:"fas fa-user-circle text-sm sm:text-base"},null,-1)),e("span",be,y(g.value.username||"Admin"),1),e("i",{class:S(["fas fa-chevron-down ml-1 text-xs transition-transform duration-200",{"rotate-180":x.value}])},null,2)]),x.value?(o(),r("div",{key:0,class:"user-menu-dropdown absolute right-0 top-full mt-2 w-48 rounded-xl border border-gray-200 bg-white py-2 shadow-xl dark:border-gray-700 dark:bg-gray-800 sm:w-56",style:{"z-index":"999999"},onClick:t[2]||(t[2]=L(()=>{},["stop"]))},[e("div",ve,[e("div",he,[t[9]||(t[9]=e("span",{class:"text-gray-500 dark:text-gray-400"},"当前版本",-1)),e("span",ke,"v"+y(a.value.current||"..."),1)]),a.value.hasUpdate?(o(),r("div",we,[e("div",_e,[t[10]||(t[10]=e("span",{class:"font-medium text-green-600 dark:text-green-400"},[e("i",{class:"fas fa-arrow-up mr-1"}),h("有新版本 ")],-1)),e("span",Ue,"v"+y(a.value.latest),1)]),e("a",{class:"block w-full rounded-lg bg-green-500 px-3 py-1.5 text-center text-sm text-white transition-colors hover:bg-green-600",href:((v=a.value.releaseInfo)==null?void 0:v.htmlUrl)||"#",target:"_blank"},t[11]||(t[11]=[e("i",{class:"fas fa-external-link-alt mr-1"},null,-1),h("查看更新 ",-1)]),8,Ce)])):a.value.checkingUpdate?(o(),r("div",Pe,t[12]||(t[12]=[e("i",{class:"fas fa-spinner fa-spin mr-1"},null,-1),h("检查更新中... ",-1)]))):(o(),r("div",Te,[w(J,{mode:"out-in",name:"fade"},{default:j(()=>[a.value.noUpdateMessage?(o(),r("div",$e,t[13]||(t[13]=[e("p",{class:"text-xs font-medium text-green-700 dark:text-green-400"},[e("i",{class:"fas fa-check-circle mr-1"}),h("当前已是最新版本 ")],-1)]))):(o(),r("button",{key:"button",class:"text-xs text-blue-500 transition-colors hover:text-blue-700 dark:text-blue-400 dark:hover:text-blue-300",onClick:t[1]||(t[1]=f=>b())},t[14]||(t[14]=[e("i",{class:"fas fa-sync-alt mr-1"},null,-1),h("检查更新 ",-1)])))]),_:1})]))]),e("button",{class:"flex w-full items-center gap-3 px-4 py-3 text-left text-gray-700 transition-colors hover:bg-gray-50 dark:text-gray-300 dark:hover:bg-gray-700",onClick:K},t[15]||(t[15]=[e("i",{class:"fas fa-key text-blue-500"},null,-1),e("span",null,"修改账户信息",-1)])),t[17]||(t[17]=e("hr",{class:"my-2 border-gray-200 dark:border-gray-700"},null,-1)),e("button",{class:"flex w-full items-center gap-3 px-4 py-3 text-left text-gray-700 transition-colors hover:bg-gray-50 dark:text-gray-300 dark:hover:bg-gray-700",onClick:q},t[16]||(t[16]=[e("i",{class:"fas fa-sign-out-alt text-red-500"},null,-1),e("span",null,"退出登录",-1)]))])):U("",!0)])])])]),u.value?(o(),r("div",Se,[e("div",Ie,[e("div",{class:"mb-6 flex items-center justify-between"},[t[20]||(t[20]=e("div",{class:"flex items-center gap-3"},[e("div",{class:"flex h-10 w-10 items-center justify-center rounded-xl bg-gradient-to-br from-blue-500 to-blue-600"},[e("i",{class:"fas fa-key text-white"})]),e("h3",{class:"text-xl font-bold text-gray-900 dark:text-gray-100"},"修改账户信息")],-1)),e("button",{class:"text-gray-400 transition-colors hover:text-gray-600 dark:hover:text-gray-300",onClick:M},t[19]||(t[19]=[e("i",{class:"fas fa-times text-xl"},null,-1)]))]),e("form",{class:"modal-scroll-content custom-scrollbar flex-1 space-y-6",onSubmit:L(O,["prevent"])},[e("div",null,[t[21]||(t[21]=e("label",{class:"mb-3 block text-sm font-semibold text-gray-700 dark:text-gray-300"},"当前用户名",-1)),e("input",{class:"form-input w-full cursor-not-allowed bg-gray-100 dark:bg-gray-700 dark:text-gray-300",disabled:"",type:"text",value:g.value.username||"Admin"},null,8,Me),t[22]||(t[22]=e("p",{class:"mt-2 text-xs text-gray-500 dark:text-gray-400"}," 当前用户名，输入新用户名以修改 ",-1))]),e("div",null,[t[23]||(t[23]=e("label",{class:"mb-3 block text-sm font-semibold text-gray-700 dark:text-gray-300"},"新用户名",-1)),P(e("input",{"onUpdate:modelValue":t[3]||(t[3]=f=>s.newUsername=f),class:"form-input w-full",placeholder:"输入新用户名（留空保持不变）",type:"text"},null,512),[[T,s.newUsername]]),t[24]||(t[24]=e("p",{class:"mt-2 text-xs text-gray-500 dark:text-gray-400"},"留空表示不修改用户名",-1))]),e("div",null,[t[25]||(t[25]=e("label",{class:"mb-3 block text-sm font-semibold text-gray-700 dark:text-gray-300"},"当前密码",-1)),P(e("input",{"onUpdate:modelValue":t[4]||(t[4]=f=>s.currentPassword=f),class:"form-input w-full",placeholder:"请输入当前密码",required:"",type:"password"},null,512),[[T,s.currentPassword]])]),e("div",null,[t[26]||(t[26]=e("label",{class:"mb-3 block text-sm font-semibold text-gray-700 dark:text-gray-300"},"新密码",-1)),P(e("input",{"onUpdate:modelValue":t[5]||(t[5]=f=>s.newPassword=f),class:"form-input w-full",placeholder:"请输入新密码",required:"",type:"password"},null,512),[[T,s.newPassword]]),t[27]||(t[27]=e("p",{class:"mt-2 text-xs text-gray-500 dark:text-gray-400"},"密码长度至少8位",-1))]),e("div",null,[t[28]||(t[28]=e("label",{class:"mb-3 block text-sm font-semibold text-gray-700 dark:text-gray-300"},"确认新密码",-1)),P(e("input",{"onUpdate:modelValue":t[6]||(t[6]=f=>s.confirmPassword=f),class:"form-input w-full",placeholder:"请再次输入新密码",required:"",type:"password"},null,512),[[T,s.confirmPassword]])]),e("div",Ne,[e("button",{class:"flex-1 rounded-xl bg-gray-100 px-6 py-3 font-semibold text-gray-700 transition-colors hover:bg-gray-200 dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-gray-600",type:"button",onClick:M}," 取消 "),e("button",{class:"btn btn-primary flex-1 px-6 py-3 font-semibold",disabled:l.value,type:"submit"},[l.value?(o(),r("div",je)):(o(),r("i",Le)),h(" "+y(l.value?"保存中...":"保存修改"),1)],8,Ae)])],32)])])):U("",!0)],64)}}},Ve=I(De,[["__scopeId","data-v-1d65ae6c"]]),Ee={class:"mb-4 sm:mb-6"},Ke={class:"block rounded-xl bg-white/10 p-2 backdrop-blur-sm dark:bg-gray-800/20 sm:hidden"},Oe=["value"],qe=["value"],ze={class:"hidden flex-wrap gap-2 rounded-2xl bg-white/10 p-2 backdrop-blur-sm dark:bg-gray-800/20 sm:flex"},Be=["onClick"],Re={class:"hidden md:inline"},Fe={class:"md:hidden"},Je={__name:"TabBar",props:{activeTab:{type:String,required:!0}},emits:["tab-change"],setup(d){const m=N(),c=C(()=>{var i;const g=[{key:"dashboard",name:"仪表板",shortName:"仪表板",icon:"fas fa-tachometer-alt"},{key:"apiKeys",name:"API Keys",shortName:"API",icon:"fas fa-key"},{key:"accounts",name:"账户管理",shortName:"账户",icon:"fas fa-user-circle"}];return(i=m.oemSettings)!=null&&i.ldapEnabled&&g.push({key:"userManagement",name:"用户管理",shortName:"用户",icon:"fas fa-users"}),g.push({key:"tutorial",name:"使用教程",shortName:"教程",icon:"fas fa-graduation-cap"},{key:"settings",name:"系统设置",shortName:"设置",icon:"fas fa-cogs"}),g});return(g,i)=>(o(),r("div",Ee,[e("div",Ke,[e("select",{class:"focus:ring-primary-color w-full rounded-lg bg-white/90 px-4 py-3 font-semibold text-gray-700 focus:outline-none focus:ring-2 dark:bg-gray-800/90 dark:text-gray-200 dark:focus:ring-indigo-400",value:d.activeTab,onChange:i[0]||(i[0]=n=>g.$emit("tab-change",n.target.value))},[(o(!0),r($,null,D(c.value,n=>(o(),r("option",{key:n.key,value:n.key},y(n.name),9,qe))),128))],40,Oe)]),e("div",ze,[(o(!0),r($,null,D(c.value,n=>(o(),r("button",{key:n.key,class:S(["tab-btn flex-1 px-3 py-2 text-xs font-semibold transition-all duration-300 sm:px-4 sm:py-3 sm:text-sm md:px-6",d.activeTab===n.key?"active":"text-gray-700 hover:bg-white/10 hover:text-gray-900 dark:text-gray-300 dark:hover:bg-gray-700/30 dark:hover:text-gray-100"]),onClick:a=>g.$emit("tab-change",n.key)},[e("i",{class:S(n.icon+" mr-1 sm:mr-2")},null,2),e("span",Re,y(n.name),1),e("span",Fe,y(n.shortName||n.name),1)],10,Be))),128))])]))}},He=I(Je,[["__scopeId","data-v-bc8f3d44"]]),Qe={class:"min-h-screen p-3 sm:p-4 md:p-6"},We={class:"glass-strong rounded-xl p-3 shadow-xl sm:rounded-2xl sm:p-4 md:rounded-3xl md:p-6",style:{"z-index":"1","min-height":"calc(100vh - 120px)"}},Ye={class:"tab-content"},Ge={__name:"MainLayout",setup(d){const m=W(),c=E(),g=N(),i=_("dashboard"),n=C(()=>{var l;const u={dashboard:"/dashboard",apiKeys:"/api-keys",accounts:"/accounts",tutorial:"/tutorial",settings:"/settings"};return(l=g.oemSettings)!=null&&l.ldapEnabled&&(u.userManagement="/user-management"),u}),a=()=>{const u=m.path,l=Object.keys(n.value).find(s=>n.value[s]===u);if(l)i.value=l;else{const s=m.name,b={Dashboard:"dashboard",ApiKeys:"apiKeys",Accounts:"accounts",Tutorial:"tutorial",Settings:"settings"};s&&b[s]?i.value=b[s]:i.value="dashboard"}};a(),H(()=>m.path,u=>{const l=Object.keys(n.value).find(s=>n.value[s]===u);if(l)i.value=l;else{const s=m.name,b={Dashboard:"dashboard",ApiKeys:"apiKeys",Accounts:"accounts",Tutorial:"tutorial",Settings:"settings"};s&&b[s]&&(i.value=b[s])}});const x=async u=>{if(n.value[u]!==m.path){i.value=u;try{await c.push(n.value[u]),await Y()}catch(l){l.name!=="NavigationDuplicated"&&(console.error("路由切换失败:",l),a())}}};return(u,l)=>{const s=Q("router-view");return o(),r("div",Qe,[w(Ve),e("div",We,[w(He,{"active-tab":i.value,onTabChange:x},null,8,["active-tab"]),e("div",Ye,[w(s)])])])}}},at=I(Ge,[["__scopeId","data-v-4d6bba6e"]]);export{at as default};
