# âš¡ DuanNaiSheQu å®æ—¶ç²¾ç¡®ä»£ç åŒæ­¥æŒ‡å—

æœ¬æ–‡æ¡£è¯¦ç»†ä»‹ç»å¦‚ä½•ä½¿ç”¨ **å®æ—¶ç²¾ç¡®ä»£ç åŒæ­¥ç³»ç»Ÿ**ï¼Œå®ç°ä¸ä¸Šæ¸¸é¡¹ç›® [Wei-Shaw/claude-relay-service](https://github.com/Wei-Shaw/claude-relay-service) çš„**ç§’çº§åŒæ­¥**ï¼Œç¡®ä¿æ‚¨çš„ä»“åº“èƒ½å¤Ÿ**å®æ—¶è·å–**ä¸Šæ¸¸çš„æ¯ä¸€ä¸ªä»£ç å˜æ›´ã€‚

## ğŸš€ ç³»ç»Ÿç‰¹æ€§

### âš¡ å®æ—¶å“åº”èƒ½åŠ›
- **ç§’çº§è§¦å‘**: ä¸Šæ¸¸æ¨é€åç«‹å³è§¦å‘åŒæ­¥ï¼ˆé€šè¿‡ webhookï¼‰
- **ç²¾ç¡®æ£€æµ‹**: å‡†ç¡®è¯†åˆ«æ¯ä¸€è¡Œä»£ç çš„å˜æ›´
- **æ™ºèƒ½åˆ†æ**: è‡ªåŠ¨åˆ†æå˜æ›´ç±»å‹ï¼ˆåŠŸèƒ½ã€ä¿®å¤ã€æ–‡æ¡£ç­‰ï¼‰
- **å¢é‡åŒæ­¥**: åªå¤„ç†çœŸæ­£å˜åŒ–çš„ä»£ç 

### ğŸ§  æ™ºèƒ½åˆå¹¶ç®—æ³•
- **ä»£ç çº§åˆ«åˆ†æ**: ç²¾ç¡®åˆ°æ¯è¡Œä»£ç çš„å˜æ›´æ£€æµ‹
- **ä¸‰è·¯æ™ºèƒ½åˆå¹¶**: è‡ªåŠ¨å¤„ç†ä»£ç å†²çª
- **å®šåˆ¶åŒ–ä¿æŠ¤**: å®Œç¾ä¿æŠ¤ DuanNaiSheQu å“ç‰ŒåŒ–å†…å®¹
- **è‡ªåŠ¨æ›¿æ¢**: æ™ºèƒ½åº”ç”¨å“ç‰Œæ ‡è¯†æ›¿æ¢è§„åˆ™

### ğŸ›¡ï¸ å®Œå–„ä¿æŠ¤æœºåˆ¶
- **æ–‡ä»¶çº§ä¿æŠ¤**: å…³é”®æ–‡ä»¶å®Œå…¨è·³è¿‡åŒæ­¥
- **å†…å®¹çº§ä¿æŠ¤**: æ™ºèƒ½è¯†åˆ«å’Œä¿æŠ¤å®šåˆ¶åŒ–å†…å®¹
- **å†²çªè§£å†³**: è‡ªåŠ¨å¤„ç†å¤§éƒ¨åˆ†åˆå¹¶å†²çª
- **å›æ»šæœºåˆ¶**: åŒæ­¥å¤±è´¥æ—¶çš„å¿«é€Ÿæ¢å¤

## ğŸ“‹ ç³»ç»Ÿæ¶æ„

```
ä¸Šæ¸¸ä»“åº“æ¨é€ â†’ Webhookè§¦å‘ â†’ GitHub Actions â†’ ç²¾ç¡®ä»£ç åˆ†æ â†’ æ™ºèƒ½åˆå¹¶ â†’ æ¨é€åˆ°æ‚¨çš„ä»“åº“
     â†“               â†“              â†“              â†“              â†“              â†“
  å®æ—¶æ£€æµ‹      ç«‹å³å“åº”      å¹¶è¡Œå¤„ç†      é€è¡Œåˆ†æ      ä¿æŠ¤å®šåˆ¶      å®ŒæˆåŒæ­¥
```

### æ ¸å¿ƒç»„ä»¶
1. **`realtime-sync.yml`** - GitHub Actions å®æ—¶åŒæ­¥å·¥ä½œæµ
2. **`webhook-listener.js`** - Webhook ç›‘å¬æœåŠ¡å™¨
3. **`realtime-sync-manager.sh`** - ç³»ç»Ÿç®¡ç†è„šæœ¬
4. **`sync-upstream.yml`** - å®šæ—¶åŒæ­¥å¤‡ä»½ï¼ˆæ¯10åˆ†é’Ÿï¼‰

## ğŸ”§ å¿«é€Ÿéƒ¨ç½²

### ç¬¬ä¸€æ­¥ï¼šåˆå§‹åŒ–ç³»ç»Ÿ
```bash
# è¿è¡Œä¸€é”®åˆå§‹åŒ–
./scripts/realtime-sync-manager.sh setup
```

åˆå§‹åŒ–è¿‡ç¨‹ä¼šï¼š
- âœ… æ£€æŸ¥ç³»ç»Ÿä¾èµ–
- âœ… é…ç½®ä¸Šæ¸¸ä»“åº“è¿æ¥
- âœ… åˆ›å»ºé…ç½®æ–‡ä»¶
- âœ… è®¾ç½®æ—¥å¿—ç›®å½•

### ç¬¬äºŒæ­¥ï¼šé…ç½® GitHub Token
```bash
# è®¾ç½® GitHub Tokenï¼ˆå¿…éœ€ï¼‰
export GITHUB_TOKEN=your_github_token_here

# æˆ–è€…å†™å…¥ ~/.bashrc æ°¸ä¹…ç”Ÿæ•ˆ
echo 'export GITHUB_TOKEN=your_github_token_here' >> ~/.bashrc
source ~/.bashrc
```

### ç¬¬ä¸‰æ­¥ï¼šå¯åŠ¨å®æ—¶ç›‘å¬æœåŠ¡
```bash
# å¯åŠ¨æœåŠ¡
./scripts/realtime-sync-manager.sh start

# æŸ¥çœ‹çŠ¶æ€
./scripts/realtime-sync-manager.sh status
```

### ç¬¬å››æ­¥ï¼šé…ç½®ä¸Šæ¸¸ä»“åº“ Webhookï¼ˆå¯é€‰ä½†æ¨èï¼‰
1. è®¿é—® https://github.com/Wei-Shaw/claude-relay-service/settings/hooks
2. ç‚¹å‡» "Add webhook"
3. å¡«å†™é…ç½®ï¼š
   - **Payload URL**: `http://your-domain:8080`
   - **Content type**: `application/json`
   - **Secret**: `duannai-sync-secret-2024`
   - **Events**: åªé€‰æ‹© `push`
4. ç‚¹å‡» "Add webhook"

## ğŸ¯ ä½¿ç”¨æ–¹æ³•

### è‡ªåŠ¨æ¨¡å¼ï¼ˆæ¨èï¼‰
ç³»ç»Ÿå¯åŠ¨åä¼šè‡ªåŠ¨ï¼š
- ğŸ”„ æ¯10åˆ†é’Ÿæ£€æŸ¥ä¸Šæ¸¸æ›´æ–°ï¼ˆå®šæ—¶å¤‡ä»½ï¼‰
- âš¡ å®æ—¶å“åº”ä¸Šæ¸¸æ¨é€äº‹ä»¶ï¼ˆwebhookè§¦å‘ï¼‰
- ğŸ§  æ™ºèƒ½åˆ†æå’Œåˆå¹¶ä»£ç å˜æ›´
- ğŸ“¤ è‡ªåŠ¨æ¨é€åˆ°æ‚¨çš„ä»“åº“

### æ‰‹åŠ¨è§¦å‘æ¨¡å¼
```bash
# æ‰‹åŠ¨è§¦å‘å®æ—¶åŒæ­¥
./scripts/realtime-sync-manager.sh trigger

# æŒ‡å®šç‰¹å®šæäº¤åŒæ­¥
./scripts/realtime-sync-manager.sh trigger abc123456

# æµ‹è¯•åŒæ­¥åŠŸèƒ½
./scripts/realtime-sync-manager.sh test
```

### ç›‘æ§å’Œç®¡ç†
```bash
# æŸ¥çœ‹ç³»ç»ŸçŠ¶æ€
./scripts/realtime-sync-manager.sh status

# å®æ—¶ç›‘æ§åŒæ­¥è¿‡ç¨‹
./scripts/realtime-sync-manager.sh monitor

# æŸ¥çœ‹åŒæ­¥æ—¥å¿—
./scripts/realtime-sync-manager.sh logs

# æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
./scripts/realtime-sync-manager.sh logs --tail 100
```

## ğŸ” ç²¾ç¡®åŒæ­¥åŸç†

### ä»£ç å˜æ›´æ£€æµ‹ç®—æ³•
```
1. è·å–ä¸Šæ¸¸æœ€æ–°æäº¤SHA
   â†“
2. å¯¹æ¯”æœ¬åœ°æœ€ååŒæ­¥çš„SHA
   â†“  
3. è®¡ç®—å˜æ›´å·®å¼‚ (git diff)
   â†“
4. åˆ†æå˜æ›´æ–‡ä»¶åˆ—è¡¨
   â†“
5. é€æ–‡ä»¶æ£€æµ‹å˜æ›´ç±»å‹
```

### æ™ºèƒ½åˆå¹¶ç­–ç•¥
```
å¯¹äºæ¯ä¸ªå˜æ›´æ–‡ä»¶ï¼š

â”œâ”€ æ˜¯å¦ä¸ºå®Œå…¨ä¿æŠ¤æ–‡ä»¶ï¼Ÿ
â”‚  â”œâ”€ Yes â†’ è·³è¿‡åŒæ­¥
â”‚  â””â”€ No â†“
â”‚
â”œâ”€ æ–‡ä»¶æ˜¯å¦åŒ…å«å®šåˆ¶åŒ–å†…å®¹ï¼Ÿ
â”‚  â”œâ”€ Yes â†’ ä¸‰è·¯æ™ºèƒ½åˆå¹¶
â”‚  â”‚  â”œâ”€ åˆå¹¶æˆåŠŸ â†’ åº”ç”¨å˜æ›´
â”‚  â”‚  â””â”€ åˆå¹¶å†²çª â†’ æ ‡è®°å¾…å¤„ç†
â”‚  â””â”€ No â†’ ç›´æ¥æ›´æ–°å¹¶åº”ç”¨å“ç‰Œæ›¿æ¢
â”‚
â””â”€ æš‚å­˜å¹¶å‡†å¤‡æäº¤
```

### å˜æ›´ç±»å‹è¯†åˆ«
ç³»ç»Ÿä¼šè‡ªåŠ¨è¯†åˆ«å¹¶ç»Ÿè®¡ï¼š
- ğŸ’« **æ–°åŠŸèƒ½**: feat/feature/add/æ–°å¢ å…³é”®è¯
- ğŸ› **Bugä¿®å¤**: fix/bug/ä¿®å¤ å…³é”®è¯  
- ğŸ“– **æ–‡æ¡£æ›´æ–°**: doc/readme/æ–‡æ¡£ å…³é”®è¯
- âš™ï¸ **é…ç½®å˜æ›´**: config/é…ç½®/è®¾ç½® å…³é”®è¯

## ğŸ“Š åŒæ­¥ç›‘æ§

### å®æ—¶çŠ¶æ€ç›‘æ§
```bash
# å¯åŠ¨å®æ—¶ç›‘æ§ç•Œé¢
./scripts/realtime-sync-manager.sh monitor
```

ç›‘æ§ç•Œé¢æ˜¾ç¤ºï¼š
- ğŸŸ¢ WebhookæœåŠ¡çŠ¶æ€
- ğŸ“‹ æœ€æ–°åŒæ­¥æ—¥å¿—
- ğŸ“ˆ åŒæ­¥ç»Ÿè®¡ä¿¡æ¯
- â±ï¸ æœ€åæ›´æ–°æ—¶é—´

### GitHub Actions ç›‘æ§
è®¿é—®ä»¥ä¸‹é“¾æ¥æŸ¥çœ‹è¯¦ç»†çš„åŒæ­¥è¿‡ç¨‹ï¼š
- å®æ—¶åŒæ­¥ï¼šhttps://github.com/DuanNaiSheQu/claude-duannai/actions/workflows/realtime-sync.yml
- å®šæ—¶åŒæ­¥ï¼šhttps://github.com/DuanNaiSheQu/claude-duannai/actions/workflows/sync-upstream.yml

### åŒæ­¥æŠ¥å‘Šç¤ºä¾‹
```
âš¡ å®æ—¶ç²¾ç¡®åŒæ­¥ä¸Šæ¸¸ä»£ç å˜æ›´

ğŸ¯ åŒæ­¥ä¿¡æ¯:
 src/services/claudeRelayService.js | 15 ++++++--
 web/admin-spa/src/views/ApiStatsView.vue | 8 ++--
 2 files changed, 18 insertions(+), 5 deletions(-)

ğŸ“¦ åŒæ­¥è¯¦æƒ…:
- ä¸Šæ¸¸ä»“åº“: Wei-Shaw/claude-relay-service
- upstream-commit:abc123456789
- åŒæ­¥æ—¶é—´: 2024-01-15 10:30:45 UTC
- å¤„ç†ç»Ÿè®¡: æˆåŠŸ:2,å†²çª:0,ä¿æŠ¤:3

ğŸ¯ å˜æ›´ç±»å‹åˆ†æ:
  ğŸ’« æ–°åŠŸèƒ½: 1 ä¸ª
  ğŸ› Bugä¿®å¤: 1 ä¸ª  
  ğŸ“– æ–‡æ¡£æ›´æ–°: 0 ä¸ª
  âš™ï¸ é…ç½®å˜æ›´: 0 ä¸ª
```

## âš™ï¸ é«˜çº§é…ç½®

### è‡ªå®šä¹‰ä¿æŠ¤è§„åˆ™
ç¼–è¾‘ `.duannai-sync-config` æ–‡ä»¶ï¼š

```bash
# å®Œå…¨è·³è¿‡çš„æ–‡ä»¶
PROTECTED_FILES=(
  ".github/workflows/auto-release-pipeline.yml"
  "README.md"
  "VERSION"
  "docs/SYNC_GUIDE.md"
  "docs/REALTIME_SYNC_GUIDE.md"
)

# å®šåˆ¶åŒ–å†…å®¹æ ‡è¯†ç¬¦
CUSTOM_MARKERS=(
  "DuanNaiSheQu"
  "claude-duannai"
  "duannaishequ"
  "9788864@gmail.com"
  "ä¸“å±å®šåˆ¶ç‰ˆ"
)
```

### è°ƒæ•´åŒæ­¥é¢‘ç‡
ç¼–è¾‘ `.github/workflows/realtime-sync.yml`ï¼š

```yaml
# æ›´é¢‘ç¹çš„å¤‡ä»½æ£€æŸ¥ (æ¯5åˆ†é’Ÿ)
schedule:
  - cron: '*/5 * * * *'

# è¾ƒå°‘çš„å¤‡ä»½æ£€æŸ¥ (æ¯30åˆ†é’Ÿ)  
schedule:
  - cron: '*/30 * * * *'
```

### Webhook æœåŠ¡é…ç½®
ç¼–è¾‘ `.realtime-sync-config`ï¼š

```bash
WEBHOOK_PORT=8080              # ç›‘å¬ç«¯å£
WEBHOOK_SECRET=your-secret     # éªŒè¯å¯†é’¥
LOG_LEVEL=debug               # æ—¥å¿—çº§åˆ«
AUTO_TRIGGER=true             # è‡ªåŠ¨è§¦å‘
NOTIFICATION_ENABLED=true     # å¯ç”¨é€šçŸ¥
```

## ğŸ› ï¸ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ

#### Q: Webhook è§¦å‘å¤±è´¥
**ç—‡çŠ¶**: ä¸Šæ¸¸æ¨é€åæ²¡æœ‰è§¦å‘åŒæ­¥
**è§£å†³**:
```bash
# æ£€æŸ¥æœåŠ¡çŠ¶æ€
./scripts/realtime-sync-manager.sh status

# é‡å¯æœåŠ¡
./scripts/realtime-sync-manager.sh stop
./scripts/realtime-sync-manager.sh start

# æ£€æŸ¥æ—¥å¿—
./scripts/realtime-sync-manager.sh logs
```

#### Q: GitHub Token è®¤è¯å¤±è´¥
**ç—‡çŠ¶**: æç¤º "401 Unauthorized"
**è§£å†³**:
```bash
# æ£€æŸ¥ token æƒé™
curl -H "Authorization: token $GITHUB_TOKEN" \
  https://api.github.com/user

# é‡æ–°è®¾ç½® token
export GITHUB_TOKEN=new_token_here
```

#### Q: åˆå¹¶å†²çªæ— æ³•è‡ªåŠ¨è§£å†³
**ç—‡çŠ¶**: æ–‡ä»¶åŒ…å«å†²çªæ ‡è®°
**è§£å†³**:
```bash
# æŸ¥çœ‹å†²çªæ–‡ä»¶
git status

# æ‰‹åŠ¨è§£å†³å†²çªåæäº¤
git add .
git commit -m "è§£å†³åŒæ­¥å†²çª"
git push origin main
```

#### Q: åŒæ­¥å»¶è¿Ÿå¤ªé«˜
**ç—‡çŠ¶**: ä¸Šæ¸¸æ›´æ–°åå¾ˆä¹…æ‰åŒæ­¥
**è§£å†³**:
1. æ£€æŸ¥ webhook é…ç½®æ˜¯å¦æ­£ç¡®
2. è°ƒæ•´å®šæ—¶åŒæ­¥é¢‘ç‡  
3. æ£€æŸ¥ç½‘ç»œè¿æ¥çŠ¶æ€

### ç´§æ€¥æ¢å¤
å¦‚æœåŒæ­¥å‡ºç°ä¸¥é‡é—®é¢˜ï¼š

```bash
# 1. åœæ­¢æ‰€æœ‰åŒæ­¥æœåŠ¡
./scripts/realtime-sync-manager.sh stop

# 2. æŸ¥çœ‹æœ€è¿‘çš„æäº¤å†å²
git log --oneline -10

# 3. å›æ»šåˆ°åŒæ­¥å‰çš„çŠ¶æ€
git reset --hard <åŒæ­¥å‰çš„æäº¤ID>

# 4. å¼ºåˆ¶æ¨é€ï¼ˆæ…ç”¨ï¼‰
git push origin main --force

# 5. é‡æ–°åˆå§‹åŒ–åŒæ­¥ç³»ç»Ÿ
./scripts/realtime-sync-manager.sh setup
```

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–

### æœ€ä½³å®è·µ
1. **åˆç†è®¾ç½®æ£€æŸ¥é¢‘ç‡**: å¹³è¡¡å®æ—¶æ€§å’Œèµ„æºæ¶ˆè€—
2. **ä¼˜åŒ–ä¿æŠ¤è§„åˆ™**: å‡å°‘ä¸å¿…è¦çš„æ–‡ä»¶å¤„ç†
3. **ç›‘æ§ç³»ç»Ÿèµ„æº**: ç¡®ä¿æœ‰è¶³å¤Ÿçš„ GitHub Actions é…é¢
4. **å®šæœŸæ¸…ç†æ—¥å¿—**: é¿å…æ—¥å¿—æ–‡ä»¶è¿‡å¤§

### æ€§èƒ½æŒ‡æ ‡
- **å“åº”æ—¶é—´**: é€šå¸¸ < 30ç§’ (ä»ä¸Šæ¸¸æ¨é€åˆ°åŒæ­¥å®Œæˆ)
- **æ£€æµ‹ç²¾åº¦**: 100% (ç²¾ç¡®åˆ°æ¯è¡Œä»£ç å˜æ›´)
- **æˆåŠŸç‡**: > 95% (è‡ªåŠ¨å¤„ç†å¤§éƒ¨åˆ†åˆå¹¶å†²çª)
- **èµ„æºæ¶ˆè€—**: æ¯æ¬¡åŒæ­¥çº¦æ¶ˆè€— 1-2 åˆ†é’Ÿ GitHub Actions æ—¶é—´

## ğŸ”„ åŒæ­¥æµç¨‹å›¾

```mermaid
graph TD
    A[ä¸Šæ¸¸ä»“åº“æ¨é€] --> B{Webhookè§¦å‘}
    B -->|æˆåŠŸ| C[GitHub Actionså¯åŠ¨]
    B -->|å¤±è´¥| D[å®šæ—¶åŒæ­¥å¤‡ä»½]
    
    C --> E[è·å–ä¸Šæ¸¸å˜æ›´]
    D --> E
    
    E --> F[åˆ†æå˜æ›´æ–‡ä»¶]
    F --> G{æ–‡ä»¶ç±»å‹åˆ¤æ–­}
    
    G -->|ä¿æŠ¤æ–‡ä»¶| H[è·³è¿‡åŒæ­¥]
    G -->|å®šåˆ¶åŒ–æ–‡ä»¶| I[æ™ºèƒ½ä¸‰è·¯åˆå¹¶]  
    G -->|æ™®é€šæ–‡ä»¶| J[ç›´æ¥æ›´æ–°+å“ç‰Œæ›¿æ¢]
    
    I --> K{åˆå¹¶ç»“æœ}
    K -->|æˆåŠŸ| L[åº”ç”¨å˜æ›´]
    K -->|å†²çª| M[æ ‡è®°å¾…å¤„ç†]
    
    J --> L
    H --> N[æäº¤ç»“æœ]
    L --> N
    M --> N
    
    N --> O[æ¨é€åˆ°ä»“åº“]
    O --> P[åŒæ­¥å®Œæˆ]
```

## ğŸ¯ ä½¿ç”¨å»ºè®®

### å¼€å‘å·¥ä½œæµé›†æˆ
1. **æ—¥å¸¸å¼€å‘**: æ­£å¸¸å¼€å‘æ‚¨çš„å®šåˆ¶åŠŸèƒ½ï¼Œç³»ç»Ÿè‡ªåŠ¨ä¿æŠ¤
2. **åŠŸèƒ½æ›´æ–°**: æ— éœ€æ‰‹åŠ¨æ“ä½œï¼Œè‡ªåŠ¨è·å–ä¸Šæ¸¸æ–°åŠŸèƒ½
3. **å†²çªå¤„ç†**: ç³»ç»Ÿä¼šæ ‡è®°éœ€è¦äººå·¥å¤„ç†çš„å†²çª
4. **ç‰ˆæœ¬ç®¡ç†**: ä¿æŒç‹¬ç«‹çš„ç‰ˆæœ¬å·å’Œå‘å¸ƒèŠ‚å¥

### å›¢é˜Ÿåä½œ
- å›¢é˜Ÿæˆå‘˜åªéœ€å…³æ³¨å®šåˆ¶åŒ–åŠŸèƒ½å¼€å‘
- ç³»ç»Ÿè‡ªåŠ¨å¤„ç†ä¸Šæ¸¸åŒæ­¥å’Œå“ç‰Œä¿æŠ¤  
- ç»Ÿä¸€çš„ä»£ç é£æ ¼å’Œæ ‡è¯†ç¬¦æ›¿æ¢
- é€æ˜çš„åŒæ­¥è¿‡ç¨‹å’Œè¯¦ç»†çš„åŒæ­¥æŠ¥å‘Š

---

é€šè¿‡è¿™å¥— **å®æ—¶ç²¾ç¡®ä»£ç åŒæ­¥ç³»ç»Ÿ**ï¼Œæ‚¨å¯ä»¥å®ç°ä¸ä¸Šæ¸¸é¡¹ç›®çš„**ç§’çº§åŒæ­¥**ï¼Œç¡®ä¿å§‹ç»ˆæ‹¥æœ‰æœ€æ–°çš„åŠŸèƒ½ç‰¹æ€§ï¼ŒåŒæ—¶å®Œç¾ä¿æŠ¤æ‚¨çš„ DuanNaiSheQu å“ç‰ŒåŒ–å†…å®¹ï¼ âš¡ğŸš€